<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Donate to ASPCA | Help Protect Animals</title>
  <meta name="description" content="Make a secure donation to support the ASPCA’s life-saving work for animals. Choose a one-time or monthly gift and see the impact your contribution can make." />
  <style>
    :root{
      --brand: #ff6f00;          /* ASPCA-like orange */
      --brand-600:#e96500;
      --brand-700:#cf5b00;
      --ink:#1e1e1e;
      --muted:#5b5b5b;
      --bg:#0f0f10;
      --card:#ffffff;
      --soft:#f6f7fb;
      --focus:#2e7dff;
      --success:#2bb673;
      --danger:#d83a3a;
      --shadow: 0 10px 25px rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.05);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:linear-gradient(180deg,#0f0f10 0%,#191a1f 100%);color:#fff;font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    a{color:var(--brand)}
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter:saturate(140%) blur(8px);
      background:linear-gradient(180deg, rgba(15,15,16,.82) 0%, rgba(15,15,16,.55) 100%);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .nav{
      max-width:1120px; margin:0 auto; padding:16px 20px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:#fff}
    .brand svg{width:34px;height:34px;filter:drop-shadow(0 2px 6px rgba(255,111,0,.35))}
    .brand .t1{font-weight:700;letter-spacing:.2px}
    .brand .t2{color:#cfd3dc;font-size:.92rem}
    .nav .cta-mini{
      padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.04);
      color:#fff;text-decoration:none;transition:.2s transform ease, .2s background ease;
    }
    .nav .cta-mini:hover{transform:translateY(-1px); background:rgba(255,255,255,.08)}
    .hero{
      position:relative; overflow:hidden;
      padding:56px 20px 24px;
    }
    .hero .wrap{max-width:1120px;margin:0 auto;display:grid;grid-template-columns:1.2fr .9fr;gap:28px;align-items:center}
    @media (max-width: 920px){ .hero .wrap{grid-template-columns:1fr} }
    .title{
      font-weight:800; font-size:clamp(28px, 4vw, 44px); line-height:1.05; margin:6px 0 14px;
      letter-spacing:-.02em;
    }
    .lede{color:#cfd3dc; max-width:640px; font-size:clamp(16px, 2vw, 18px)}
    .chips{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    .chips .chip{
      padding:9px 14px;border-radius:999px;border:1px solid rgba(255,255,255,.12);color:#fff;text-decoration:none;font-weight:600;background:rgba(255,255,255,.04);
      transition:.2s ease; cursor:pointer; user-select:none
    }
    .chips .chip:hover{transform:translateY(-1px); background:rgba(255,255,255,.08)}
    .donation-card{
      background:var(--card); color:#101114; border-radius:var(--radius); box-shadow:var(--shadow);
      padding:22px; position:relative; overflow:hidden;
      animation:floatIn .5s ease both .05s;
    }
    @keyframes floatIn{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none}}
    .glow{
      position:absolute; inset:-30% -10% auto auto; width:440px; height:440px; border-radius:50%;
      background: radial-gradient(closest-side, rgba(255,111,0,.22), rgba(255,111,0,0));
      pointer-events:none; filter:blur(18px);
    }
    .segmented{
      display:inline-flex; border:1px solid #eaeaf0; border-radius:12px; overflow:hidden; background:#f5f6fa;
    }
    .segmented button{
      padding:10px 16px; border:0; background:transparent; font-weight:700; color:#444; cursor:pointer;
      transition:.2s ease; min-width:126px;
    }
    .segmented button.active{background:#fff; color:#111; box-shadow:0 1px 0 rgba(0,0,0,.03) inset}
    .amounts{display:flex; flex-wrap:wrap; gap:10px; margin:14px 0 6px}
    .amounts .amt{
      flex:1 0 100px; padding:12px 14px; border-radius:12px; border:1px solid #e9e9f2; background:#fff; cursor:pointer;
      font-weight:700; text-align:center; transition:.18s ease; color:#101114;
    }
    .amounts .amt:hover{transform:translateY(-1px);}
    .amounts .amt.active{outline:2px solid var(--brand); box-shadow:0 6px 16px rgba(255,111,0,.18)}
    .custom-amt{
      margin-top:10px; display:flex; align-items:center; gap:10px; background:#fafbff; border:1px solid #ececf4; border-radius:12px; padding:8px 12px;
    }
    .custom-amt .pre{color:#7a7f8b}
    .custom-amt input{
      appearance:textfield; border:0; background:transparent; font-size:1.1rem; font-weight:700; width:140px; outline:none; color:#101114
    }
    .hint{color:#6b7080; font-size:.92rem}
    .divider{height:1px;background:#ececf4;margin:18px 0}
    .form-row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:680px){ .form-row{grid-template-columns:1fr} }
    .field{display:flex; flex-direction:column; gap:6px}
    label{font-size:.92rem; color:#2e3240}
    input, select{
      border:1px solid #e6e7ef; border-radius:12px; padding:12px 12px; font-size:1rem; outline:none; background:#fff;
      transition:border .12s ease, box-shadow .12s ease;
    }
    input:focus, select:focus{border-color:var(--focus); box-shadow:0 0 0 3px rgba(46,125,255,.16)}
    .pay-methods{display:flex; gap:10px; margin:6px 0 8px}
    .pill{
      padding:10px 12px; border-radius:12px; border:1px solid #e6e7ef; background:#fff; cursor:pointer; display:flex; align-items:center; gap:8px; transition:.18s;
    }
    .pill.active{outline:2px solid var(--brand)}
    .card-grid{display:grid; grid-template-columns:2fr 1fr 1fr; gap:10px}
    @media (max-width:680px){ .card-grid{grid-template-columns:1fr} }
    .cta{
      display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:10px; flex-wrap:wrap;
    }
    .cta .submit{
      background:linear-gradient(180deg, var(--brand) 0%, var(--brand-600) 100%); color:#fff; border:0; border-radius:14px; padding:14px 18px; font-weight:800; letter-spacing:.2px;
      box-shadow:0 10px 20px rgba(255,111,0,.25), 0 2px 5px rgba(0,0,0,.1); cursor:pointer; transition:transform .12s ease, filter .2s ease;
    }
    .cta .submit:hover{transform:translateY(-1px); filter:saturate(110%)}
    .cta .secure{display:flex; align-items:center; gap:8px; color:#6b7080; font-size:.92rem}
    .impact{
      max-width:1120px; margin:16px auto 60px; padding:0 20px; display:grid; gap:16px; grid-template-columns:repeat(3, 1fr);
    }
    @media (max-width:920px){ .impact{grid-template-columns:1fr} }
    .impact .card{
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px 18px; backdrop-filter:saturate(130%) blur(4px);
      transition:transform .2s ease, background .2s ease;
    }
    .impact .card:hover{transform:translateY(-3px); background:rgba(255,255,255,.08)}
    .impact .card h3{margin:8px 0 6px}
    .impact .card p{color:#cfd3dc; margin:0}
    footer{
      border-top:1px solid rgba(255,255,255,.08); color:#cfd3dc; padding:22px 20px 40px;
    }
    footer .wrap{max-width:1120px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap}
    .subtle{color:#9ba3af;font-size:.92rem}
    .link-btn{border:0;background:transparent;color:var(--brand);cursor:pointer;text-decoration:underline}
    .note{background:#fff7f1; border:1px solid #ffe3cc; color:#6a3d00; border-radius:12px; padding:10px 12px; font-size:.95rem}
    /* Modal */
    .modal{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.55);
      z-index:100;
    }
    .modal[open]{display:flex}
    .modal .sheet{
      width:min(620px, 92vw); background:#ffffff; color:#111; border-radius:16px; box-shadow:0 30px 60px rgba(0,0,0,.3);
      padding:18px 18px 16px; animation:floatIn .24s ease;
    }
    .sheet h2{margin:6px 0 2px}
    .sheet p{color:#475065}
    .sheet .row{display:flex; justify-content:space-between; gap:10px; margin:12px 0}
    .sheet .actions{display:flex; justify-content:flex-end; gap:10px; margin-top:12px}
    .btn{padding:11px 14px; border-radius:12px; border:1px solid #e6e7ef; background:#fff; cursor:pointer}
    .btn.primary{background:var(--brand); border-color:var(--brand-600); color:#fff; font-weight:700}
    .close-x{
      position:absolute; right:10px; top:8px; border:0; background:transparent; font-size:22px; cursor:pointer; color:#6b7080
    }
    .hidden{display:none !important}
    .error{color:var(--danger); font-size:.9rem}

    /* Light theme overrides */
    body.light{
      color:#1e1e1e;
      background:#ffffff; /* flatter, lighter background */
    }
    body.light header{
      background:#ffffff; /* remove heavy gradient */
      border-bottom:1px solid rgba(17,24,39,.08);
      backdrop-filter:none; /* lighten GPU usage */
    }
    body.light .brand{color:#111}
    body.light .brand .t2{color:#4b5563}
    body.light .brand svg{filter:drop-shadow(0 2px 6px rgba(255,111,0,.18))}
    body.light .nav .cta-mini{
      border-color:rgba(0,0,0,.08);
      background:#ffffff;
      color:#111;
    }
    body.light .nav .cta-mini:hover{background:#f7f7f7}
    body.light .lede{color:#4b5563}
    body.light .chips .chip{
      border-color:rgba(17,24,39,.12);
      background:#ffffff;
      color:#111;
    }
    body.light .chips .chip:hover{background:#f7f7f7}
    body.light .impact .card{
      background:#ffffff;
      border:1px solid #e5e7eb;
      backdrop-filter:none;
      box-shadow:0 4px 12px rgba(0,0,0,.05);
    }
    body.light .impact .card:hover{
      background:#ffffff;
      box-shadow:0 8px 18px rgba(0,0,0,.07);
    }
    body.light .impact .card p{color:#4b5563}
    body.light footer{
      border-top:1px solid rgba(17,24,39,.08);
      color:#6b7280;
      background:transparent;
    }
    body.light .subtle{color:#6b7280}
    /* Lighten call-to-action button and card glow */
    body.light .cta .submit{
      background:#ff7a12; /* subtle flat brand tone */
      box-shadow:0 6px 12px rgba(255,122,18,.18), 0 1px 3px rgba(0,0,0,.06);
    }
    body.light .donation-card{ box-shadow:0 8px 20px rgba(0,0,0,.06); }
    body.light .glow{ display:none; } /* remove heavy visual glow for a lighter feel */
  </style>
</head>
<body class="light">
  <header>
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="#top">
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#ff9a3d" />
              <stop offset=".6" stop-color="#ff6f00" />
              <stop offset="1" stop-color="#cf5b00" />
            </linearGradient>
          </defs>
          <path fill="url(#g1)" d="M28 9c3 0 6 3 6 7s-3 7-6 7-6-3-6-7 3-7 6-7Zm18 4c2 0 5 3 5 6s-3 6-5 6-5-3-5-6 3-6 5-6ZM12 16c3 0 6 3 6 7s-3 7-6 7-6-3-6-7 3-7 6-7Zm19 11c8 0 17 7 17 15 0 7-8 11-17 11s-17-4-17-11c0-8 9-15 17-15Z"/>
        </svg>
        <div>
          <div class="t1">Support ASPCA</div>
          <div class="t2">American Society for the Prevention of Cruelty to Animals</div>
        </div>
      </a>
      <a class="cta-mini" href="#donate">Donate Now</a>
    </nav>
  </header>

  <main id="top">
    <section class="hero" aria-labelledby="h1">
      <div class="wrap">
        <div>
          <h1 id="h1" class="title __wpg_hover" data-__wpg_prev_outline="" data-__wpg_prev_outline_offset="" data-__wpg_prev_boxshadow="" style="outline: rgba(0, 0, 0, 0.5) dashed 2px; outline-offset: 2px;">Monkeys need our help!</h1>
          <p class="lede">Every contribution helps the ASPCA respond to cruelty, provide emergency medical care, and give vulnerable animals a second chance.</p>
          <div class="chips" role="navigation" aria-label="Quick actions">
            <a href="#donate" class="chip">Give Monthly</a>
            <a href="#impact" class="chip">See Your Impact</a>
            <a href="#footer" class="chip">Questions?</a>
          </div>
        </div>
        <div id="donate" class="donation-card" role="region" aria-labelledby="donate-title">
          <div class="glow" aria-hidden="true"></div>
          <h2 id="donate-title" style="margin:4px 0 10px">Your gift</h2>
          <div class="segmented" role="tablist" aria-label="Donation frequency">
            <button role="tab" aria-selected="true" class="freq-btn active" data-freq="monthly">Monthly</button>
            <button role="tab" aria-selected="false" class="freq-btn" data-freq="once">One‑time</button>
          </div>

          <div class="amounts" role="radiogroup" aria-label="Select an amount">
            <!-- Amount buttons inserted by JS -->
          </div>
          <div class="custom-amt" aria-live="polite">
            <span class="pre">$</span>
            <input id="customAmount" inputmode="decimal" pattern="\d+(\.\d{1,2})?" placeholder="Other amount" aria-label="Other amount" />
          </div>
          <div class="hint" id="impact-hint">Your monthly gift of $25 helps provide warm shelter and nutritious meals.</div>

          <div class="divider"></div>

          <form id="donationForm" novalidate>
            <div class="form-row">
              <div class="field">
                <label for="firstName">First name</label>
                <input id="firstName" name="firstName" autocomplete="given-name" required />
              </div>
              <div class="field">
                <label for="lastName">Last name</label>
                <input id="lastName" name="lastName" autocomplete="family-name" required />
              </div>
            </div>
            <div class="form-row">
              <div class="field">
                <label for="email">Email</label>
                <input id="email" type="email" name="email" autocomplete="email" required />
              </div>
              <div class="field">
                <label for="phone">Phone (optional)</label>
                <input id="phone" type="tel" name="phone" autocomplete="tel" />
              </div>
            </div>

            <div class="note" style="margin-top:8px">
              Prefer to give directly on the ASPCA website? Visit aspca.org/ways-to-give.
              <a href="https://www.aspca.org/ways-to-give" target="_blank" rel="noopener">Open official site</a>
            </div>

            <div class="divider"></div>

            <div>
              <label>Payment method</label>
              <div class="pay-methods" role="radiogroup" aria-label="Payment method">
                <div class="pill active" data-method="card" role="radio" aria-checked="true" tabindex="0">
                  <span aria-hidden="true">💳</span><span>Credit / Debit</span>
                </div>
                <div class="pill" data-method="paypal" role="radio" aria-checked="false" tabindex="0">
                  <span aria-hidden="true">🅟</span><span>PayPal</span>
                </div>
              </div>
              <div id="cardFields">
                <div class="card-grid">
                  <input id="ccNumber" inputmode="numeric" autocomplete="cc-number" placeholder="Card number" required />
                  <input id="ccExp" inputmode="numeric" autocomplete="cc-exp" placeholder="MM/YY" required />
                  <input id="ccCvc" inputmode="numeric" autocomplete="cc-csc" placeholder="CVC" required />
                </div>
                <div class="form-row" style="margin-top:10px">
                  <div class="field">
                    <label for="addr">Billing address</label>
                    <input id="addr" autocomplete="address-line1" placeholder="Street address" required />
                  </div>
                  <div class="field">
                    <label for="city">City</label>
                    <input id="city" autocomplete="address-level2" required />
                  </div>
                </div>
                <div class="form-row">
                  <div class="field">
                    <label for="state">State / Province</label>
                    <input id="state" autocomplete="address-level1" />
                  </div>
                  <div class="field">
                    <label for="zip">ZIP / Postal code</label>
                    <input id="zip" autocomplete="postal-code" required />
                  </div>
                </div>
              </div>
              <div id="paypalNote" class="hint hidden">You’ll be redirected to PayPal to securely complete your donation.</div>
            </div>

            <div class="cta">
              <div class="secure">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="#6b7080" d="M12 1a5 5 0 0 1 5 5v3h1a2 2 0 0 1 2 2v8a4 4 0 0 1-4 4H8a4 4 0 0 1-4-4v-8a2 2 0 0 1 2-2h1V6a5 5 0 0 1 5-5Zm0 2a3 3 0 0 0-3 3v3h6V6a3 3 0 0 0-3-3Z"/></svg>
                Secure 256‑bit encryption
              </div>
              <div>
                <span id="formError" class="error" role="alert" aria-live="polite"></span>
              </div>
              <button type="submit" class="submit" id="submitBtn" disabled>Donate</button>
            </div>

          </form>
        </div>
      </div>
    </section>

    <section id="impact" class="impact" aria-labelledby="impt">
      <div class="card">
        <div aria-hidden="true">🏠</div>
        <h3 id="impt">Shelter & care</h3>
        <p>Your gift helps provide warm shelter, clean bedding, and daily meals to animals recovering from cruelty and neglect.</p>
      </div>
      <div class="card">
        <div aria-hidden="true">🩺</div>
        <h3>Medical treatment</h3>
        <p>Support spay/neuter services, vaccinations, and life‑saving surgeries for pets who need urgent care.</p>
      </div>
      <div class="card">
        <div aria-hidden="true">🚑</div>
        <h3>Emergency rescue</h3>
        <p>Enable rapid response teams to rescue animals from disasters and abusive situations across the country.</p>
      </div>
    </section>
  </main>

  <footer id="footer">
    <div class="wrap">
      <div class="subtle">This page is a donation experience for supporters of the ASPCA. For official information and direct giving options, visit aspca.org.</div>
      <div class="subtle">
        <a href="https://www.aspca.org/privacy-policy" target="_blank" rel="noopener">Privacy</a> •
        <a href="https://www.aspca.org/terms-use" target="_blank" rel="noopener">Terms</a>
      </div>
    </div>
  </footer>

  <dialog class="modal" id="confirmModal" aria-labelledby="confirmTitle" aria-modal="true">
    <div class="sheet" role="document">
      <button class="close-x" aria-label="Close" id="closeModal">×</button>
      <h2 id="confirmTitle">Confirm your donation</h2>
      <p id="confirmSummary">Review your details below before completing your gift.</p>
      <div class="row">
        <div>
          <div class="subtle">Donor</div>
          <div id="donorLine" style="font-weight:700"></div>
        </div>
        <div style="text-align:right">
          <div class="subtle">Amount</div>
          <div id="amountLine" style="font-weight:800"></div>
        </div>
      </div>
      <div class="note" style="margin-top:6px">
        Tip: You can also donate directly on the ASPCA’s official website.
        <a href="https://secure.aspca.org/donate" target="_blank" rel="noopener">Go to aspca.org</a>
      </div>
      <div class="actions">
        <button class="btn" id="editBtn">Edit</button>
        <a class="btn primary" href="https://secure.aspca.org/donate" target="_blank" rel="noopener" id="proceedReal">Proceed to secure checkout</a>
      </div>
    </div>
  </dialog>

  <script>
    (function(){
      const freqButtons = Array.from(document.querySelectorAll('.freq-btn'));
      const amountsWrap = document.querySelector('.amounts');
      const hint = document.getElementById('impact-hint');
      const customAmt = document.getElementById('customAmount');
      const form = document.getElementById('donationForm');
      const submitBtn = document.getElementById('submitBtn');
      const errorEl = document.getElementById('formError');
      const modal = document.getElementById('confirmModal');
      const closeModal = document.getElementById('closeModal');
      const editBtn = document.getElementById('editBtn');
      const donorLine = document.getElementById('donorLine');
      const amountLine = document.getElementById('amountLine');

      const payPills = Array.from(document.querySelectorAll('.pill'));
      const cardFields = document.getElementById('cardFields');
      const paypalNote = document.getElementById('paypalNote');

      let state = {
        freq: 'monthly',
        amount: 25,
        method: 'card',
        presetSelected: true
      };

      const presets = {
        monthly: [15, 25, 35, 50, 100],
        once: [25, 50, 100, 250, 500]
      };

      function format(n){
        const v = Number(n || 0);
        return v.toLocaleString(undefined, { style:'currency', currency:'USD', maximumFractionDigits: 0 });
      }

      function renderAmounts(){
        amountsWrap.innerHTML = '';
        presets[state.freq].forEach((val, idx) => {
          const b = document.createElement('button');
          b.type = 'button';
          b.className = 'amt' + ((state.amount === val && state.presetSelected) ? ' active' : '');
          b.setAttribute('role','radio');
          b.setAttribute('aria-checked', (state.amount === val && state.presetSelected) ? 'true' : 'false');
          b.textContent = format(val);
          b.dataset.value = String(val);
          b.addEventListener('click', () => {
            state.amount = val;
            state.presetSelected = true;
            customAmt.value = '';
            updateUI();
          });
          amountsWrap.appendChild(b);
          if(idx === 0 && state.presetSelected && typeof state.amount === 'undefined'){
            state.amount = val;
          }
        });
      }

      function updateHint(){
        const impactMonthly = [
          'Your monthly gift helps provide warm shelter and nutritious meals.',
          'Monthly support sustains rescues and critical medical care.',
          'You’ll help more animals find loving homes all year long.'
        ];
        const impactOnce = [
          'Your one‑time gift provides immediate care for animals in crisis.',
          'You’re helping fund rescue operations and treatment.',
          'Thank you for making a difference today.'
        ];
        const arr = state.freq === 'monthly' ? impactMonthly : impactOnce;
        const msg = (state.freq === 'monthly' ? 'Your monthly gift of ' : 'Your one‑time gift of ') + format(state.amount || 0) + ' — ' + arr[(state.amount || 0) % arr.length];
        hint.textContent = msg;
      }

      function updateSubmit(){
        const base = state.freq === 'monthly' ? 'Donate monthly' : 'Donate once';
        submitBtn.textContent = `${base} — ${format(state.amount || 0)}`;
      }

      function updateUI(){
        // Update segmented
        freqButtons.forEach(b => {
          const active = b.dataset.freq === state.freq;
          b.classList.toggle('active', active);
          b.setAttribute('aria-selected', active ? 'true' : 'false');
        });
        // Re-render amounts
        renderAmounts();
        // Highlight selected preset if any
        Array.from(amountsWrap.children).forEach(btn => {
          const isActive = state.presetSelected && Number(btn.dataset.value) === Number(state.amount);
          btn.classList.toggle('active', isActive);
          btn.setAttribute('aria-checked', isActive ? 'true' : 'false');
        });
        // Update hint & submit
        updateHint();
        updateSubmit();
        validate();
      }

      freqButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          state.freq = btn.dataset.freq;
          // reset amount to a friendly default
          state.amount = presets[state.freq][1] || presets[state.freq][0];
          state.presetSelected = true;
          customAmt.value = '';
          updateUI();
        });
      });

      customAmt.addEventListener('input', () => {
        const raw = customAmt.value.replace(/[^\d.]/g, '');
        let val = parseFloat(raw);
        if(isNaN(val)) { state.amount = 0; }
        else {
          // clamp to two decimals and min $5
          val = Math.round(val * 100) / 100;
          state.amount = val;
        }
        state.presetSelected = false;
        updateUI();
      });

      function setPayMethod(m){
        state.method = m;
        payPills.forEach(p => {
          const act = p.dataset.method === m;
          p.classList.toggle('active', act);
          p.setAttribute('aria-checked', act ? 'true' : 'false');
        });
        const card = m === 'card';
        cardFields.classList.toggle('hidden', !card);
        paypalNote.classList.toggle('hidden', card);
        validate();
      }

      payPills.forEach(p => {
        p.addEventListener('click', () => setPayMethod(p.dataset.method));
        p.addEventListener('keydown', (e) => {
          if(e.key === 'Enter' || e.key === ' '){
            e.preventDefault(); setPayMethod(p.dataset.method);
          }
        });
      });

      function emailValid(v){
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(v||'').trim());
      }

      function validate(){
        errorEl.textContent = '';
        const min = 5;
        let ok = true;
        if(!state.amount || state.amount < min){
          ok = false;
          errorEl.textContent = `Please enter at least ${format(min)}.`;
        }
        const first = document.getElementById('firstName').value.trim();
        const last = document.getElementById('lastName').value.trim();
        const email = document.getElementById('email').value.trim();
        if(!(first && last && emailValid(email))){
          ok = false;
        }
        if(state.method === 'card'){
          const req = ['ccNumber','ccExp','ccCvc','addr','city','zip'];
          for(const id of req){
            const el = document.getElementById(id);
            if(!el.value.trim()){ ok = false; break; }
          }
        }
        submitBtn.disabled = !ok;
        return ok;
      }

      document.querySelectorAll('input,select').forEach(el => {
        el.addEventListener('input', validate);
        el.addEventListener('change', validate);
      });

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        if(!validate()){ return; }
        const name = `${document.getElementById('firstName').value.trim()} ${document.getElementById('lastName').value.trim()}`;
        const freqText = state.freq === 'monthly' ? 'Monthly' : 'One‑time';
        donorLine.textContent = `${name} • ${document.getElementById('email').value.trim()}`;
        amountLine.textContent = `${freqText} • ${format(state.amount)}`;
        modal.setAttribute('open','');
        // Focus trap: move to close button
        closeModal.focus();
      });

      function closeTheModal(){
        modal.removeAttribute('open');
      }

      closeModal.addEventListener('click', closeTheModal);
      editBtn.addEventListener('click', closeTheModal);
      modal.addEventListener('click', (e) => {
        if(e.target === modal) closeTheModal();
      });
      document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape' && modal.hasAttribute('open')) closeTheModal();
      });

      // Initialize
      updateUI();
      setPayMethod('card');
    })();
  </script>
</body>
</html>
<script>(function(){try{var proto=location.protocol==='https:'?'wss':'ws';var ws=new WebSocket(proto+'://'+location.host+'/ws');ws.onmessage=function(e){if(e.data==='reload'){location.reload();}}}catch(e){}})();</script>
<script>(function(){try{var proto=location.protocol==='https:'?'wss':'ws';var ws=new WebSocket(proto+'://'+location.host+'/ws');ws.onmessage=function(e){if(e.data==='reload'){location.reload();}}}catch(e){}})();</script>