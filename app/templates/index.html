<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WPG - WebPageGenie</title>
  <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <header>
    <div class="brand">
      <button id="toggle-sidebar" class="btn btn-ghost btn-sm me-2 icon-btn" type="button" aria-pressed="false" aria-label="Toggle left sidebar"><i class="bi bi-chevron-left"></i></button>
      <img src="/static/logo.svg" alt="Web Page Genie" class="logo" onerror="this.style.display='none'" />
      <h1>Web Page Genie</h1>
    </div>
    <nav class="d-flex align-items-center gap-2 flex-nowrap header-tools">
      <div class="input-group input-group-sm" id="preview-path">
        <span class="input-group-text bg-transparent">Preview</span>
        <span class="input-group-text bg-transparent">/pages/</span>
        <select id="preview-slug" class="form-select form-select-sm">
          {% for p in pages %}
          <option value="{{ p }}">{{ p }}</option>
          {% endfor %}
        </select>
        <span class="input-group-text bg-transparent">/index.html</span>
      </div>
      <div class="btn-group ms-2" role="group" aria-label="Version navigation">
        <button id="prev-version" class="btn btn-success btn-sm" type="button" title="Older version">← Prev</button>
        <button id="next-version" class="btn btn-success btn-sm" type="button" title="Newer version">Next →</button>
      </div>
      <span id="version-label" class="small ms-2"></span>
      <div class="btn-group ms-2" role="group" aria-label="Viewport size">
        <button id="vp-mobile" class="btn btn-ghost btn-sm icon-btn" type="button" title="Mobile"><i class="bi bi-phone"></i></button>
        <button id="vp-tablet" class="btn btn-ghost btn-sm icon-btn" type="button" title="Tablet"><i class="bi bi-tablet"></i></button>
        <button id="vp-desktop" class="btn btn-ghost btn-sm icon-btn" type="button" title="Desktop"><i class="bi bi-pc-display"></i></button>
      </div>
      <button id="edit-context" class="btn btn-ghost btn-sm ms-2" type="button" title="Edit system context" data-bs-toggle="modal" data-bs-target="#contextModal">Edit Context</button>
      <button id="pick-element" class="btn btn-ghost btn-sm ms-2" type="button" title="Pick element in preview">Pick Element</button>
      <button id="toggle-theme" class="btn btn-ghost btn-sm ms-2 icon-btn" type="button" title="Toggle dark/light"><i class="bi bi-moon"></i></button>
      <button id="toggle-right" class="btn btn-ghost btn-sm ms-auto icon-btn" type="button" aria-pressed="false" aria-label="Toggle LangGraph sidebar"><i class="bi bi-chevron-right"></i></button>
    </nav>
  </header>

  <main class="py-3">
    <div class="layout">
      <!-- Pinned collapsible sidebar -->
      <aside id="sidebar" class="sidebar">
        <div class="sidebar-inner">
          

          <div class="card bg-transparent border-0 chat">
            <div class="card-body">
              <h5 class="card-title">Ask WebPageGenie</h5>
              <form id="chat-form" class="controls">
                <textarea id="chat-input" class="form-control" rows="5" placeholder="Ask to create or edit a page..."></textarea>
                <div class="row mt-2">
                  <div class="col-12 position-relative">
                    <label class="form-label mb-1"><span>Page</span></label>
                    <input id="page-select" class="form-control" placeholder="Type to select or create…" autocomplete="off" />
                    <div id="page-suggestions" class="dropdown-menu w-100" style="display:none; max-height:180px; overflow:auto"></div>
                  </div>
                  <div class="col-12 mt-2" id="ref-section" style="display:none;">
                    <label class="form-label mb-1"><span>Example site (optional)</span></label>
                    <div class="input-group input-group-sm">
                      <input id="ref-url" class="form-control" placeholder="https://example.com" disabled />
                      <button id="ref-check" class="btn btn-ghost btn-sm" type="button" disabled>Check</button>
                      <span id="ref-status" class="input-group-text" style="display:none;"></span>
                    </div>
                    <div class="form-check mt-2">
                      <input class="form-check-input" type="checkbox" value="1" id="ref-images" disabled>
                      <label class="form-check-label" for="ref-images">Extract images for AI (save locally)</label>
                    </div>
                    <div class="form-text">Provide a public URL to guide design for a new page. We’ll verify accessibility.</div>
                  </div>
                  <div class="col-12 mt-2">
                    <label class="form-label mb-1"><span>Retrieval</span></label>
                    <select id="retrieval-method" class="form-select">
                      <option value="vector" selected>Vector</option>
                      <option value="hybrid">Hybrid</option>
                    </select>
                  </div>
                </div>
                <div class="d-grid mt-2">
                  <button type="submit" class="btn btn-success">Send</button>
                </div>
              </form>
            </div>
          </div>
          <div class="mt-auto pt-2 d-grid text-center small sidebar-footer">Sidebar</div>
        </div>
      </aside>

      <!-- Preview area (fills remaining space) -->
      <section id="preview-area" class="preview-area">
        <div class="card flex-fill" id="preview-card">
          <div class="card-body d-flex flex-column" style="gap: 8px;">
            <div class="flex-fill">
              <iframe id="preview-frame" src="about:blank" class="w-100" style="height:calc(100vh - 140px); border:1px solid rgba(255,255,255,0.15); border-radius:8px; background:#fff"></iframe>
            </div>
          </div>
        </div>
      </section>

      <!-- Right sidebar (LangGraph), collapsible like the left -->
      <aside id="rightbar" class="rightbar collapsed">
        <div class="rightbar-inner">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="m-0 text-white">LangGraph</h6>
          </div>
          <iframe src="/graph" title="LangGraph" class="w-100" style="height: calc(100vh - 110px); border:1px solid rgba(255,255,255,0.15); border-radius:8px; background:#fff"></iframe>
        </div>
      </aside>
    </div>
  </main>

  <!-- Context Modal -->
  <div class="modal fade" id="contextModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content" style="background:#0b1220; color:#fff;">
        <div class="modal-header border-0">
          <h5 class="modal-title">Edit System Context</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <textarea id="context-text" class="form-control" rows="10" style="background:#0e1730; color:#fff; border:1px solid rgba(255,255,255,0.15)"></textarea>
          <div class="form-text text-white-50 mt-2">This context is sent with your request to guide the model. It defaults to an expert SPA design brief.</div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="save-context" class="btn btn-success" data-bs-dismiss="modal">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Output Modal -->
  <div class="modal fade" id="outputModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content" style="background:var(--bg); color:var(--fg);">
        <div class="modal-header border-0">
          <h5 class="modal-title">Processing</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <pre id="chat-output" class="mt-0" style="background:var(--inputBg); color:var(--fg); border:1px solid var(--border); border-radius:8px; padding:12px; max-height:60vh; overflow:auto;"></pre>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-success" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script id="pages-data" type="application/json">{{ pages | tojson }}</script>
  <script src="/static/client.js"></script>
</body>
</html>
